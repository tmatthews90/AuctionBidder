<div id="main-container" class="container-fluid">
  <h1>
    {{itemType}}
  </h1>
  <div class="row">
    <div *ngFor="let item of items" class="col-lg-4 col-md-6 col-sm-12 my-2">
      <div class="card">
        <img class="card-img-top d-sm-none d-xs-none d-md-block w-75 mx-auto mt-3" style="height: auto" src="{{item.imageUrl || '../../../assets/placeholder-image.png'}}">
        <div class="card-body">
          <h5 class="card-title">
            #{{item.id}} {{item.name}}
            <span *ngIf="item.available === false" class="badge badge-danger ml-2">UNAVAILABLE</span>
            <span *ngIf="item.sold" class="badge badge-danger ml-2">SOLD</span>
            <span *ngIf="item.totalAvailable < 1 && item.packageType === packageTypes.MultiSale" class="badge badge-danger ml-2">SOLD OUT</span>
          </h5>
          <div>
            <p>{{item.description}}</p>
          </div>
          <div *ngIf="item.packageType === packageTypes.MultiSale">
            <span class="font-weight-bold">Total Available:</span>
            <span class="float-right">{{item.totalAvailable
              <=1 ? '0' : item.totalAvailable}}</span>
          </div>
          <div *ngIf="item.packageType !== packageTypes.MultiSale">
            <div>
              <span class="font-weight-bold">Current Bid:</span>
              <span class="float-right mx-2" [@increaseState]="item.state">{{item.currentBid | currency:'CAD':'symbol-narrow'}}</span>
            </div>
            <div *ngIf="item.available && !item.sold">
              <span class="font-weight-bold">Bid Increment:</span>
              <span class="float-right mx-2">{{item.bidIncrement | currency:'CAD':'symbol-narrow'}}</span>
            </div>
            <div *ngIf="item.available && !item.sold">
              <span class="font-weight-bold">Next Bid:</span>
              <span class="float-right mx-2">{{item.currentBid + item.bidIncrement | currency:'CAD':'symbol-narrow'}}</span>
            </div>
            <div>
              <span class="font-weight-bold">Current Winner:</span>
              <span class="float-right mx-2">{{item.currentWinner ? item.currentWinner.firstName + ' ' + item.currentWinner.lastName : 'No bids placed'}}</span>
            </div>
          </div>
          <div class="mt-2" *ngIf="item.available && !item.sold">
            <button *ngIf="currentBidder ? item.currentWinner?.bidderNumber === currentBidder.BidderNumber : false" type="button" class="btn btn-primary" disabled>Winning</button>
            <button *ngIf="item.packageType !== packageTypes.MultiSale && !(currentBidder ? item.currentWinner?.bidderNumber === currentBidder.BidderNumber : false)" type="button" class="btn btn-primary" (click)="placeBid(item.id, item.currentBid + item.bidIncrement)"
              [disabled]="!item.available || item.sold || (item.packageType === packageTypes.MultiSale && item.totalAvailable < 1)">Place Bid for {{item.currentBid + item.bidIncrement | currency:'CAD':'symbol-narrow'}}</button>
            <button *ngIf="item.buyNowPrice && item.packageType !== packageTypes.MultiSale" type="button" class="btn btn-success float-right"
              (click)="buyNow(item.id)" [disabled]="!item.available || item.sold || (item.packageType === packageTypes.MultiSale && item.totalAvailable < 1)">Buy Now {{item.buyNowPrice | currency:'CAD':'symbol-narrow'}}</button>
            <button *ngIf="item.buyNowPrice && item.packageType === packageTypes.MultiSale" type="button" class="btn btn-primary" [disabled]="item.totalAvailable < 1 || !item.available"
              (click)="purchaseItem(item.id)">{{ item.totalAvailable > 0 ? 'Buy Now ' + (item.buyNowPrice | currency:'CAD':'symbol-narrow') : 'SOLD OUT'}}</button>
            <div *ngIf="item.goal > 0" class="mt-2 text-center font-weight-bold">
              Goal
              <p-progressBar [value]="getGoalPercentage(item)"></p-progressBar>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog header="Enter Bidder Number" [(visible)]="displayLogin">
  <app-login></app-login>
</p-dialog>
